"use strict";(self.webpackChunkquilt_navigator=self.webpackChunkquilt_navigator||[]).push([[5560],{25560:(e,n,t)=>{t.r(n),t.d(n,{default:()=>Oe});var a=t(70655),i=t(7694),r=t(95142),l=t(3735),o=t(32521),c=t(97716),u=t(26598),s=t(917),d=t(68981),m=t(19344),p=t(62825),g=t(95847),f=t(66115),k=t(13454),v=t(57438),E=t(8599),b=t(30601),Z=t(15288),h=t(13646),x=t(59211),N=t(67826),y=t(84734),S=t(70475),C=t(67294),w=t(66688),D=t(16550),I=t(92432),F=t(10529),B=t(39803),A=t(41120),T=t(868),_=t(92863),P=t(95875),M=t(50743),V=t(22318),j=t(282),J=t(66083),R=t(29525),W=t(66856),U=t(95477),q=t(52663),L=t(7212),O=t(79895),z=t(82302),G=t(99613),X=t(57394),$=t(88222),Q=t(66869),H=t(86226),Y=t(22966),K=t(23307),ee=t(67456),ne=t(46974),te=t(83962),ae=t(94998),ie=t(57156),re=t(69534),le=t(6626),oe=t(23915),ce=t(82268),ue=t(65434),se=t(14194),de=t(31708),me=t(21587),pe=t(77246),ge=[{kind:"FragmentDefinition",name:{kind:"Name",value:"BucketConfigSelection"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"BucketConfig"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"iconUrl"}},{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"relevanceScore"}},{kind:"Field",name:{kind:"Name",value:"overviewUrl"}},{kind:"Field",name:{kind:"Name",value:"tags"}},{kind:"Field",name:{kind:"Name",value:"linkedData"}},{kind:"Field",name:{kind:"Name",value:"fileExtensionsToIndex"}},{kind:"Field",name:{kind:"Name",value:"indexContentBytes"}},{kind:"Field",name:{kind:"Name",value:"scannerParallelShardsDepth"}},{kind:"Field",name:{kind:"Name",value:"snsNotificationArn"}},{kind:"Field",name:{kind:"Name",value:"skipMetaDataIndexing"}},{kind:"Field",name:{kind:"Name",value:"lastIndexed"}}]}}],fe={kind:"Document",definitions:(0,a.ev)([{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"containers_Admin_Buckets_gql_BucketConfigs"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"bucketConfigs"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"BucketConfigSelection"}}]}}]}}],ge,!0)},ke={kind:"Document",definitions:(0,a.ev)([{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"containers_Admin_Buckets_gql_BucketsAdd"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"BucketAddInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"bucketAdd"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"BucketAddSuccess"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"bucketConfig"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"BucketConfigSelection"}}]}}]}}]}}]}}],ge,!0)},ve={kind:"Document",definitions:(0,a.ev)([{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"containers_Admin_Buckets_gql_BucketsUpdate"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"name"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"BucketUpdateInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"bucketUpdate"},arguments:[{kind:"Argument",name:{kind:"Name",value:"name"},value:{kind:"Variable",name:{kind:"Name",value:"name"}}},{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"BucketUpdateSuccess"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"bucketConfig"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"BucketConfigSelection"}}]}}]}}]}}]}}],ge,!0)},Ee={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"containers_Admin_Buckets_gql_BucketsRemove"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"name"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"bucketRemove"},arguments:[{kind:"Argument",name:{kind:"Name",value:"name"},value:{kind:"Variable",name:{kind:"Name",value:"name"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}}]}}]}}]},be={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"containers_Admin_Buckets_gql_ContentIndexingSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"config"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"contentIndexingSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"extensions"}},{kind:"Field",name:{kind:"Name",value:"bytesDefault"}},{kind:"Field",name:{kind:"Name",value:"bytesMin"}},{kind:"Field",name:{kind:"Name",value:"bytesMax"}}]}}]}}]}}]},Ze=/^arn:aws(-|\w)*:sns:(-|\w)*:\d*:\S+$/,he="DO_NOT_SUBSCRIBE",xe=Symbol(he),Ne=new o.Type("SnsFormValue",(function(e){return e===xe||o.string.is(e)}),(function(e,n){return e===xe||"string"==typeof e?o.success(e):o.failure(e,n)}),c.Z),ye=l.ls(se.Jx(se.ij(o.string,"")),u.Z(/['"]/g,""),s.Z(","),d.Z(m.Z(p.Z,g.Z)),f.Z((function(e){return!e})),k.Z,v.Z(c.Z),(function(e){return e.length?e:null})),Se=/\.[0-9a-z_]+/,Ce=l.ls(ye,(function(e){return e&&!e.every(E.Z(Se))?"validExtensions":void 0})),we={title:m.Z(b.Z("title"),se.Jx(o.string),p.Z,se.Jx(se.CM)),iconUrl:m.Z(b.Z("iconUrl"),se.Jx(se.ij(o.string,"")),p.Z,(function(e){return e||null})),description:m.Z(b.Z("description"),se.Jx(se.ij(o.string,"")),p.Z,(function(e){return e||null})),relevanceScore:m.Z(b.Z("relevanceScore"),se.Jx(se.ij(o.string,"")),(function(e){return e||null}),se.Jx(se.AG(se.jV))),overviewUrl:m.Z(b.Z("overviewUrl"),se.Jx(se.ij(o.string,"")),p.Z,(function(e){return e||null})),tags:m.Z(b.Z("tags"),se.Jx(se.ij(o.string,"")),s.Z(","),d.Z(p.Z),f.Z((function(e){return!e})),k.Z,(function(e){return e.length?e:null})),linkedData:m.Z(b.Z("linkedData"),se.Jx(se.ij(o.string,"")),(function(e){return e.trim()||"null"}),se.Jx(se.Xh(se.Dw,null))),fileExtensionsToIndex:function(e){return e.enableDeepIndexing?l.zG(e.fileExtensionsToIndex,ye):[]},indexContentBytes:function(e){return e.enableDeepIndexing?l.zG(e.indexContentBytes,se.Jx(se.ij(o.string,"")),p.Z,Z.Z(h.Z(""),x.Z(null),se.Jx(se.jV))):0},scannerParallelShardsDepth:m.Z(b.Z("scannerParallelShardsDepth"),se.Jx(se.ij(o.string,"")),(function(e){return e||null}),se.Jx(se.AG(se.jV))),snsNotificationArn:m.Z(b.Z("snsNotificationArn"),se.Jx(se.AG(Ne)),(function(e){if(e===xe)return he;var n=null==e?void 0:e.trim();return n||null})),skipMetaDataIndexing:m.Z(b.Z("skipMetaDataIndexing"),se.Jx(se.ij(o.boolean,!1)))},De=(0,a.pi)((0,a.pi)({},we),{name:m.Z(b.Z("name"),se.Jx(o.string),p.Z,se.Jx(se.CM)),delayScan:m.Z(b.Z("delayScan"),se.Jx(se.ij(o.boolean,!1)))});function Ie(e){if(e&&e!==xe)return Ze.test(e)?void 0:"invalidArn"}var Fe={invalidArn:"Enter a valid SNS topic ARN or leave blank",topicNotFound:"No such topic, enter a valid SNS topic ARN or leave blank",configurationError:"Notification configuration error"};function Be(e){var n=e.input,t=n.onChange,a=n.value,i=void 0===a?"":a,r=e.meta,l=r.submitFailed&&(r.error||r.submitError),o=C.useCallback((function(e,n){t(n?xe:"")}),[t]),c=C.useCallback((function(e){t(e.target.value)}),[t]);return C.createElement(F.Z,{mt:2},C.createElement(me.XZ,{meta:r,checked:i===xe,onChange:o,label:"Skip S3 notifications (not recommended)"}),C.createElement(B.Z,{error:!!l,helperText:l?Fe[l]||l:void 0,label:"SNS Topic ARN",placeholder:"Enter ARN (leave blank to auto-fill)",fullWidth:!0,margin:"normal",disabled:i===xe||r.submitting||r.submitSucceeded,onChange:c,value:i===xe?he:i,InputLabelProps:{shrink:!0}}))}var Ae=A.Z((function(e){return{icon:{fontSize:"1.125em",marginLeft:e.spacing(.5),marginTop:-1,opacity:.5,verticalAlign:-4,"&:hover":{opacity:1}},tooltip:{"& ul":{marginBottom:0,marginTop:e.spacing(.5),paddingLeft:e.spacing(2)}}}}));function Te(e){var n=e.children,t=Ae();return C.createElement(T.ZP,{arrow:!0,title:n,classes:{tooltip:t.tooltip}},C.createElement(_.Z,{fontSize:"small",className:t.icon},"help"))}var _e=A.Z((function(e){return{group:{"& > *:first-child":{marginTop:0}},panel:{margin:"0 !important","&::before":{content:"none"}},panelSummary:{padding:0,minHeight:"auto !important"},panelSummaryContent:{margin:"".concat(e.spacing(1),"px 0 !important")},warning:{background:e.palette.warning.main,marginBottom:e.spacing(1),marginTop:e.spacing(2)},warningIcon:{color:e.palette.warning.dark}}}));function Pe(e){var n=e.bucket,t=e.reindex,a=_e(),i=I.aM({query:be})[0],r=i.error,l=i.data;if(!l&&r)throw r;var o=le.D$();C.useEffect((function(){l&&r&&o("captureException",r)}),[r,l,o]);var c=l.config.contentIndexingSettings;return C.createElement(F.Z,null,C.createElement(F.Z,{className:a.group,mt:-1,pb:2},n?C.createElement(B.Z,{label:"Name",value:n.name,fullWidth:!0,margin:"normal",disabled:!0}):C.createElement(w.gN,{component:me.gN,name:"name",label:"Name",placeholder:"Enter an S3 bucket name",parse:m.Z(g.Z,u.Z(/[^a-z0-9-.]/g,""),N.Z(63)),validate:de.C1,errors:{required:"Enter a bucket name",conflict:"Bucket already added",noSuchBucket:"No such bucket"},fullWidth:!0,margin:"normal"}),C.createElement(w.gN,{component:me.gN,name:"title",label:"Title",placeholder:'e.g. "Production analytics data"',parse:m.Z(u.Z(/^\s+/g,""),N.Z(256)),validate:de.C1,errors:{required:"Enter a bucket title"},fullWidth:!0,margin:"normal"}),C.createElement(w.gN,{component:me.gN,name:"iconUrl",label:"Icon URL (optional)",placeholder:"e.g. https://some-cdn.com/icon.png",helperText:"Recommended size: 80x80px",parse:m.Z(p.Z,N.Z(1024)),fullWidth:!0,margin:"normal"}),C.createElement(w.gN,{component:me.gN,name:"description",label:"Description (optional)",placeholder:"Enter description if required",parse:m.Z(u.Z(/^\s+/g,""),N.Z(1024)),multiline:!0,rows:1,rowsMax:3,fullWidth:!0,margin:"normal"})),C.createElement(P.Z,{elevation:0,className:a.panel},C.createElement(M.Z,{expandIcon:C.createElement(_.Z,null,"expand_more"),classes:{root:a.panelSummary,content:a.panelSummaryContent}},C.createElement(V.Z,{variant:"h6"},"Metadata")),C.createElement(F.Z,{className:a.group,pt:1,pb:2},C.createElement(w.gN,{component:me.gN,name:"relevanceScore",label:"Relevance score",placeholder:"Higher numbers appear first, -1 to hide",parse:m.Z(u.Z(/[^0-9-]/g,""),u.Z(/(.+)-+$/g,"$1"),N.Z(16)),validate:de._L,errors:{integer:"Enter a valid integer"},fullWidth:!0,margin:"normal"}),C.createElement(w.gN,{component:me.gN,name:"tags",label:"Tags (comma-separated)",placeholder:'e.g. "geospatial", for bucket discovery',fullWidth:!0,margin:"normal",multiline:!0,rows:1,rowsMax:3}),C.createElement(w.gN,{component:me.gN,name:"overviewUrl",label:"Overview URL",parse:p.Z,fullWidth:!0,margin:"normal"}),C.createElement(w.gN,{component:me.gN,name:"linkedData",label:"Structured data (JSON-LD)",validate:de.OQ,errors:{jsonObject:"Must be a valid JSON object"},fullWidth:!0,multiline:!0,rows:1,rowsMax:10,margin:"normal"}))),C.createElement(P.Z,{elevation:0,className:a.panel},C.createElement(M.Z,{expandIcon:C.createElement(_.Z,null,"expand_more"),classes:{root:a.panelSummary,content:a.panelSummaryContent}},C.createElement(V.Z,{variant:"h6"},"Indexing and notifications")),C.createElement(F.Z,{className:a.group,pt:1},!!t&&C.createElement(F.Z,{pb:2.5},C.createElement(j.Z,{variant:"outlined",fullWidth:!0,onClick:t},"Re-index and repair")),C.createElement(w.gN,{component:me.XZ,type:"checkbox",name:"enableDeepIndexing",label:C.createElement(C.Fragment,null,"Enable deep indexing",C.createElement(Te,null,"Deep indexing adds the ",C.createElement("em",null,"contents")," of an object to your search index, while shallow indexing only covers object metadata. Deep indexing may require more disk in ElasticSearch. Enable deep indexing when you want your users to find files by their contents."))}),C.createElement(w.lP,{subscription:{modified:!0,values:!0}},(function(e){var t=e.modified,i=e.values;if(!n)return null;if(!(null==t?void 0:t.enableDeepIndexing)&&!(null==t?void 0:t.fileExtensionsToIndex)&&!(null==t?void 0:t.indexContentBytes))return null;try{if(h.Z(n.fileExtensionsToIndex,we.fileExtensionsToIndex(i))&&h.Z(n.indexContentBytes,we.indexContentBytes(i)))return null}catch(e){return null}return C.createElement(Q.Z,{className:a.warning,icon:C.createElement(_.Z,{fontSize:"inherit",className:a.warningIcon},"error"),severity:"warning"},"Changing these settings affects files that are indexed after the change. If you wish to deep index existing files, click"," ",C.createElement("strong",null,'"Re-index and repair"'),".")})),C.createElement(w.lP,{subscription:{values:!0}},(function(e){var n,t;return e.values.enableDeepIndexing?C.createElement(C.Fragment,null,C.createElement(w.gN,{component:me.gN,name:"fileExtensionsToIndex",label:C.createElement(C.Fragment,null,"File extensions to deep index (comma-separated)",C.createElement(Te,null,"Default extensions:",C.createElement("ul",null,c.extensions.map((function(e){return C.createElement("li",{key:e},e)}))))),placeholder:'e.g. ".txt, .md", leave blank to use default settings',validate:Ce,errors:{validExtensions:C.createElement(C.Fragment,null,"Enter a comma-separated list of"," ",C.createElement("abbr",{title:"Must start with the dot and contain only alphanumeric characters thereafter"},"valid")," ","file extensions")},fullWidth:!0,margin:"normal",multiline:!0,rows:1,rowsMax:3}),C.createElement(w.gN,{component:me.gN,name:"indexContentBytes",label:C.createElement(C.Fragment,null,"Content bytes to deep index",C.createElement(Te,null,"Defaults to ",c.bytesDefault)),placeholder:'e.g. "1024", leave blank to use default settings',parse:u.Z(/[^0-9]/g,""),validate:(n=c.bytesMin,t=c.bytesMax,function(e){if(e){var a=Number(e);return!Number.isInteger(a)||a<n||a>t?"integerInRange":void 0}}),errors:{integerInRange:C.createElement(C.Fragment,null,"Enter an integer from ",c.bytesMin," to ",c.bytesMax)},fullWidth:!0,margin:"normal"})):null})),C.createElement(w.gN,{component:me.gN,name:"scannerParallelShardsDepth",label:"Scanner parallel shards depth",placeholder:"Leave blank to use default settings",validate:de._L,errors:{integer:"Enter a valid integer"},parse:m.Z(u.Z(/[^0-9]/g,""),N.Z(16)),fullWidth:!0,margin:"normal"}),C.createElement(w.gN,{component:Be,name:"snsNotificationArn",validate:Ie}),C.createElement(F.Z,{mt:2},C.createElement(w.gN,{component:me.XZ,type:"checkbox",name:"skipMetaDataIndexing",label:"Skip metadata indexing"})),!n&&C.createElement(F.Z,{mt:1},C.createElement(w.gN,{component:me.XZ,type:"checkbox",name:"delayScan",label:"Delay scan"})))))}function Me(){return C.createElement(C.Fragment,null,y.Z((function(e){return C.createElement(K.Z,{key:e,height:48,mt:e?3:0})}),5))}function Ve(e){var n=this,t=e.close,i=ee.D$().push,l=(0,ue.Q4)(),o=I.Db(ke)[1],c=C.useCallback((function(e){return(0,a.mG)(n,void 0,void 0,(function(){var n,c,u,s,d,m,p;return(0,a.Jh)(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),n=S.Z(De)(e),[4,o({input:n})];case 1:if((c=a.sent()).error)throw c.error;if(!c.data)throw new Error("No data");switch((u=c.data.bucketAdd).__typename){case"BucketAddSuccess":return i('Bucket "'.concat(u.bucketConfig.name,'" added')),l.track("WEB",{type:"admin",action:"bucket add",bucket:u.bucketConfig.name}),t(),[2,void 0];case"BucketAlreadyAdded":return[2,{name:"conflict"}];case"BucketDoesNotExist":return[2,{name:"noSuchBucket"}];case"SnsInvalid":return[2,{snsNotificationArn:"invalidArn"}];case"NotificationTopicNotFound":return[2,{snsNotificationArn:"topicNotFound"}];case"NotificationConfigurationError":return[2,(d={snsNotificationArn:"configurationError"},d[r.Ck]="notificationConfigurationError",d)];case"InsufficientPermissions":return[2,(m={},m[r.Ck]="insufficientPermissions",m)];case"BucketIndexContentBytesInvalid":return[2,{indexContentBytes:"integerInRange"}];case"BucketFileExtensionsToIndexInvalid":return[2,{fileExtensionsToIndex:"validExtensions"}];default:return[2,(0,oe.Z)(u)]}return[3,3];case 2:return s=a.sent(),console.error("Error adding bucket"),console.error(s),[2,(p={},p[r.Ck]="unexpected",p)];case 3:return[2]}}))}))}),[o,i,t,l]);return C.createElement(w.l0,{onSubmit:c,initialValues:{enableDeepIndexing:!0}},(function(e){var n=e.handleSubmit,a=e.submitting,i=e.submitFailed,r=e.error,l=e.submitError,o=e.hasValidationErrors;return C.createElement(C.Fragment,null,C.createElement(J.Z,null,"Add a bucket"),C.createElement(R.Z,null,C.createElement(C.Suspense,{fallback:C.createElement(Me,null)},C.createElement("form",{onSubmit:n},C.createElement(Pe,null),i&&C.createElement(me.Xq,{error:r||l,errors:{unexpected:"Something went wrong",notificationConfigurationError:"Notification configuration error",insufficientPermissions:"Insufficient permissions"}}),C.createElement("input",{type:"submit",style:{display:"none"}})))),C.createElement(W.Z,null,a&&C.createElement(te.Z,null,(function(){return C.createElement(F.Z,{flexGrow:1,display:"flex",pl:2},C.createElement(U.Z,{size:24}))})),C.createElement(j.Z,{onClick:function(){return t("cancel")},color:"primary",disabled:a},"Cancel"),C.createElement(j.Z,{onClick:n,color:"primary",disabled:a||i&&o},"Add")))}))}function je(e){var n=this,t=e.bucket,i=e.open,r=e.close,l=ne.D$(),o=C.useState(!1),c=o[0],u=o[1],s=C.useState(!1),d=s[0],m=s[1],p=C.useState(!1),g=p[0],f=p[1],k=C.useState(!1),v=k[0],E=k[1],b=C.useCallback((function(){m(!1),f(!1),u(!1),E(!1)}),[]),Z=C.useCallback((function(e,n){u(n)}),[]),h=C.useCallback((function(){return(0,a.mG)(n,void 0,void 0,(function(){var e;return(0,a.Jh)(this,(function(n){switch(n.label){case 0:if(d)return[2];E(!1),m(!0),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,l({endpoint:"/admin/reindex/".concat(t),method:"POST",body:{repair:c||void 0}})];case 2:return n.sent(),f(!0),[3,4];case 3:return e=n.sent(),ne.Bb.is(e,404,"Bucket not found")?E("Bucket not found"):ne.Bb.is(e,409,/in progress/)?E("Indexing already in progress"):(console.log("Error re-indexing bucket:"),console.error(e),E("Unexpected error")),[3,4];case 4:return m(!1),[2]}}))}))}),[d,l,t,c]),x=C.useCallback((function(){d||r()}),[d,r]);return C.createElement(q.Z,{open:i,onClose:x,onExited:b,fullWidth:!0},C.createElement(J.Z,null,"Re-index and repair a bucket"),g?C.createElement(R.Z,null,C.createElement(L.Z,{color:"textPrimary"},"We have ",c&&C.createElement(C.Fragment,null,"repaired S3 notifications and "),"started re-indexing the bucket.")):C.createElement(R.Z,null,C.createElement(L.Z,{color:"textPrimary"},"You are about to start re-indexing the ",C.createElement("b",null,'"',t,'"')," bucket"),C.createElement(me.XZ,{meta:{submitting:d,submitSucceeded:g},input:{checked:c,onChange:Z},label:"Repair S3 notifications"}),c&&C.createElement(F.Z,{color:"warning.dark",ml:4},C.createElement(V.Z,{color:"inherit",variant:"caption"},"Bucket notifications will be overwritten"))),C.createElement(W.Z,null,d&&C.createElement(te.Z,null,(function(){return C.createElement(F.Z,{flexGrow:1,display:"flex",pl:2},C.createElement(U.Z,{size:24}))})),!d&&!!v&&C.createElement(F.Z,{flexGrow:1,display:"flex",alignItems:"center",pl:2},C.createElement(_.Z,{color:"error"},"error_outline"),C.createElement(F.Z,{pl:1}),C.createElement(V.Z,{variant:"body2",color:"error"},v)),g?C.createElement(C.Fragment,null,C.createElement(j.Z,{onClick:r,color:"primary"},"Close")):C.createElement(C.Fragment,null,C.createElement(j.Z,{onClick:r,disabled:d,color:"primary"},"Cancel"),C.createElement(j.Z,{onClick:h,disabled:d,color:"primary"},"Re-index",c&&C.createElement(C.Fragment,null," and repair")))))}function Je(e){var n,t,i=this,l=e.bucket,o=e.close,c=I.Db(ve)[1],u=C.useState(!1),s=u[0],d=u[1],m=C.useCallback((function(){return d(!0)}),[]),p=C.useCallback((function(){return d(!1)}),[]),g=C.useCallback((function(e){return(0,a.mG)(i,void 0,void 0,(function(){var n,t,i,u,s,d,m;return(0,a.Jh)(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),n=S.Z(we)(e),[4,c({name:l.name,input:n})];case 1:if((t=a.sent()).error)throw t.error;if(!t.data)throw new Error("No data");switch((i=t.data.bucketUpdate).__typename){case"BucketUpdateSuccess":return o(),[2,void 0];case"SnsInvalid":return[2,{snsNotificationArn:"invalidArn"}];case"NotificationTopicNotFound":return[2,{snsNotificationArn:"topicNotFound"}];case"NotificationConfigurationError":return[2,(s={snsNotificationArn:"configurationError"},s[r.Ck]="notificationConfigurationError",s)];case"BucketNotFound":return[2,(d={},d[r.Ck]="bucketNotFound",d)];case"BucketIndexContentBytesInvalid":return[2,{indexContentBytes:"integerInRange"}];case"BucketFileExtensionsToIndexInvalid":return[2,{fileExtensionsToIndex:"validExtensions"}];default:return[2,(0,oe.Z)(i)]}return[3,3];case 2:return u=a.sent(),console.error("Error updating bucket"),console.error(u),[2,(m={},m[r.Ck]="unexpected",m)];case 3:return[2]}}))}))}),[c,o,l.name]),f={title:l.title,iconUrl:l.iconUrl||"",description:l.description||"",relevanceScore:l.relevanceScore.toString(),overviewUrl:l.overviewUrl||"",tags:(l.tags||[]).join(", "),linkedData:l.linkedData?JSON.stringify(l.linkedData):"",enableDeepIndexing:!h.Z(l.fileExtensionsToIndex,[])&&0!==l.indexContentBytes,fileExtensionsToIndex:(l.fileExtensionsToIndex||[]).join(", "),indexContentBytes:l.indexContentBytes,scannerParallelShardsDepth:(null===(n=l.scannerParallelShardsDepth)||void 0===n?void 0:n.toString())||"",snsNotificationArn:l.snsNotificationArn===he?xe:l.snsNotificationArn,skipMetaDataIndexing:null!==(t=l.skipMetaDataIndexing)&&void 0!==t&&t};return C.createElement(w.l0,{onSubmit:g,initialValues:f},(function(e){var n=e.handleSubmit,t=e.submitting,a=e.submitFailed,i=e.error,r=e.submitError,c=e.hasValidationErrors,u=e.pristine,d=e.form;return C.createElement(C.Fragment,null,C.createElement(je,{bucket:l.name,open:s,close:p}),C.createElement(J.Z,null,'Edit the "',l.name,'" bucket'),C.createElement(R.Z,null,C.createElement(C.Suspense,{fallback:C.createElement(Me,null)},C.createElement("form",{onSubmit:n},C.createElement(Pe,{bucket:l,reindex:m}),a&&C.createElement(me.Xq,{error:i||r,errors:{unexpected:"Something went wrong",notificationConfigurationError:"Notification configuration error",bucketNotFound:"Bucket not found"}}),C.createElement("input",{type:"submit",style:{display:"none"}})))),C.createElement(W.Z,null,t&&C.createElement(te.Z,null,(function(){return C.createElement(F.Z,{flexGrow:1,display:"flex",pl:2},C.createElement(U.Z,{size:24}))})),C.createElement(j.Z,{onClick:function(){return d.reset()},color:"primary",disabled:u||t},"Reset"),C.createElement(j.Z,{onClick:function(){return o("cancel")},color:"primary",disabled:t},"Cancel"),C.createElement(j.Z,{onClick:n,color:"primary",disabled:u||t||a&&c},"Save")))}))}function Re(e){var n=this,t=e.bucket,i=e.close,r=ee.D$().push,l=(0,ue.Q4)(),o=I.Db(Ee)[1],c=C.useCallback((function(){return(0,a.mG)(n,void 0,void 0,(function(){var e,n,c;return(0,a.Jh)(this,(function(a){switch(a.label){case 0:i(),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,o({name:t.name})];case 2:if((e=a.sent()).error)throw e.error;if(!e.data)throw new Error("No data");switch((n=e.data.bucketRemove).__typename){case"BucketRemoveSuccess":return l.track("WEB",{type:"admin",action:"bucket delete",bucket:t.name}),[2];case"IndexingInProgress":return r("Can't delete bucket \"".concat(t.name,"\" while it's being indexed")),[2];case"BucketNotFound":return r("Can't delete bucket \"".concat(t.name,'": not found')),[2];default:(0,oe.Z)(n)}return[3,4];case 3:return c=a.sent(),r('Error deleting bucket "'.concat(t.name,'"')),console.error("Error deleting bucket"),console.error(c),[3,4];case 4:return[2]}}))}))}),[t,i,o,r,l]);return C.createElement(C.Fragment,null,C.createElement(J.Z,null,"Delete a bucket"),C.createElement(R.Z,null,'You are about to disconnect "',t.name,'" from Quilt. The search index will be deleted. Bucket contents will remain unchanged.'),C.createElement(W.Z,null,C.createElement(j.Z,{onClick:function(){return i("cancel")},color:"primary"},"Cancel"),C.createElement(j.Z,{onClick:c,color:"primary"},"Delete")))}var We=A.Z({stub:{opacity:.7}});function Ue(e){var n=e.src,t=We();return C.createElement(H.Z,{alt:"",classes:t,src:n,title:"Default icon"})}var qe=[{id:"name",label:"Name (relevance)",getValue:b.Z("name"),getDisplay:function(e,n){return C.createElement("span",null,C.createElement(F.Z,{fontFamily:"monospace.fontFamily",component:"span"},e)," ",C.createElement(F.Z,{color:"text.secondary",component:"span"},"(",n.relevanceScore,")"))}},{id:"icon",label:"Icon",sortable:!1,align:"center",getValue:b.Z("iconUrl"),getDisplay:function(e){return C.createElement(Ue,{src:e})}},{id:"title",label:"Title",getValue:b.Z("title"),getDisplay:function(e){return C.createElement(F.Z,{component:"span",maxWidth:240,textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",display:"inline-block"},e)}},{id:"description",label:"Description",getValue:b.Z("description"),getDisplay:function(e){return e?C.createElement(F.Z,{component:"span",maxWidth:240,textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",display:"inline-block"},e):C.createElement(F.Z,{color:"text.secondary",component:"span"},"<Empty>")}},{id:"lastIndexed",label:"Last indexed",getValue:b.Z("lastIndexed"),getDisplay:function(e){return e?C.createElement("span",{title:e.toLocaleString()},i.Z(e,{addSuffix:!0})):C.createElement(F.Z,{color:"text.secondary",component:"span"},"<N/A>")}}];function Le(e){var n=e.bucketName,t=I.aM({query:fe})[0],i=t.error,r=t.data;if(!r&&i)throw i;var l=le.D$();C.useEffect((function(){r&&i&&l("captureException",i)}),[i,r,l]);var o=r.bucketConfigs,u=pe.Pl({rows:o,column:qe[0]}),s=Y.D$(u.ordered,{getItemId:b.Z("name")}),d=ae.D(),m=d.open,p=d.render,g=re.D$().urls,f=D.k6(),k=[{title:"Add bucket",icon:C.createElement(_.Z,null,"add"),fn:C.useCallback((function(){m((function(e){var n=e.close;return C.createElement(Ve,(0,a.pi)({},{close:n}))}))}),[m])}],v=function(e){return function(){f.push(g.adminBuckets(e.name))}},E=C.useMemo((function(){return n?o.find((function(e){return e.name===n})):null}),[n,o]),Z=C.useCallback((function(){f.push(g.adminBuckets())}),[f,g]);return n&&!E?C.createElement(D.l_,{to:g.adminBuckets()}):C.createElement(O.Z,null,p({maxWidth:"xs",fullWidth:!0}),C.createElement(q.Z,{open:!!E,fullWidth:!0,maxWidth:"xs"},E&&C.createElement(Je,{bucket:E,close:Z})),C.createElement(pe.o8,{heading:"Buckets",actions:k}),C.createElement(pe.im,null,C.createElement(z.Z,{size:"small"},C.createElement(pe.Fb,{columns:qe,ordering:u,withInlineActions:!0}),C.createElement(G.Z,null,s.paginated.map((function(e){return C.createElement(X.Z,{hover:!0,key:e.name,onClick:v(e),style:{cursor:"pointer"}},qe.map((function(n){return C.createElement($.Z,(0,a.pi)({key:n.id,align:n.align},n.props),(n.getDisplay||c.Z)(n.getValue(e),e))})),C.createElement($.Z,{align:"right",padding:"none",onClick:function(e){return e.stopPropagation()}},C.createElement(pe.xS,{actions:(n=e,[{title:"Delete",icon:C.createElement(_.Z,null,"delete"),fn:function(){m((function(e){var t=e.close;return C.createElement(Re,(0,a.pi)({},{bucket:n,close:t}))}))}},{title:"Edit",icon:C.createElement(_.Z,null,"edit"),fn:v(n)}])})));var n}))))),C.createElement(pe.tl,{pagination:s}))}function Oe(e){var n=e.location,t=(0,ce.Z)(n.search).bucket,a=Array.isArray(t)?t[0]:t;return C.createElement(F.Z,{mt:2,mb:2},C.createElement(ie.Z,null,["Buckets","Admin"]),C.createElement(C.Suspense,{fallback:C.createElement(O.Z,null,C.createElement(pe.o8,{heading:"Buckets"}),C.createElement(pe.Ex,null))},C.createElement(Le,{bucketName:a})))}},21587:(e,n,t)=>{t.d(n,{XZ:()=>m,Xq:()=>g,gN:()=>s});var a=t(70655),i=t(67294),r=t(39803),l=t(41120),o=t(30553),c=t(13258),u=t(22318);function s(e){var n=e.input,t=e.meta,l=e.errors,o=e.helperText,c=e.InputLabelProps,u=(0,a._T)(e,["input","meta","errors","helperText","InputLabelProps"]),s=t.submitFailed&&(t.error||t.submitError),d=(0,a.pi)((0,a.pi)({error:!!s,helperText:s?l[s]||s:o,disabled:t.submitting||t.submitSucceeded,InputLabelProps:(0,a.pi)({shrink:!0},c)},n),u);return i.createElement(r.Z,(0,a.pi)({},d))}var d=l.Z({root:{marginBottom:-9,marginTop:-9}});function m(e){var n=e.input,t=void 0===n?{}:n,r=e.meta,l=(e.errors,e.label),u=void 0===l?void 0:l,s=e.FormControlLabelProps,m=void 0===s?{}:s,p=(0,a._T)(e,["input","meta","errors","label","FormControlLabelProps"]),g=d();return i.createElement(o.Z,(0,a.pi)({},m,{control:i.createElement(c.Z,(0,a.pi)({classes:g,disabled:r.submitting||r.submitSucceeded},t,p)),label:u}))}var p=l.Z((function(e){return{root:{marginTop:e.spacing(3),"& a":{textDecoration:"underline"}}}}));function g(e){var n=e.error,t=e.errors,r=(0,a._T)(e,["error","errors"]),l=p();return n?i.createElement(u.Z,(0,a.pi)({color:"error",classes:l},r),t[n]||n):null}},57156:(e,n,t)=>{t.d(n,{Z:()=>o});var a=t(70655),i=t(67294),r=t(64593);function l(e,n){return function(e,n){return n?Array.isArray(n)?(0,a.ev)((0,a.ev)([],n,!0),[e],!1):[n,e]:[e]}(e,n).join(" â€¢ ")}function o(e){var n=e.children,t=e.base,a=void 0===t?"Quilt is a versioned data hub for AWS":t;return i.createElement(r.q,null,i.createElement("title",null,l(a,n)))}},14194:(e,n,t)=>{t.d(n,{AG:()=>p,CM:()=>s.CM,Dw:()=>s.Dw,Jx:()=>m,Km:()=>f,Xh:()=>s.Xh,ij:()=>s.ij,jV:()=>s.jV});var a,i=t(70655),r=t(80070),l=t(32521),o=t(84144),c=t(19344),u=t(36155),s=t(96882),d=function(e){function n(n){var t=(0,o.formatValidationErrors)(n).join("\n");return e.call(this,"ValidationError\n".concat(t))||this}return(0,i.ZT)(n,e),n}(u.G),m=function(e){return c.Z(e.decode,r.g_((function(e){throw new d(e)}),(function(e){return e})))},p=function(e,n){return void 0===n&&(n="Nullable<".concat(e.name,">")),new l.Type(n,(function(n){return null===n||e.is(n)}),(function(n,t){return null==n?l.success(null):e.validate(n,t)}),(function(e){return e}))};a||(a={});var g=function(e){function n(n,t){var a=e.call(this,t,(function(e){return!!a.enumValues.has(e)&&"number"!=typeof a.enum[e]}),(function(e,n){return a.is(e)?l.success(e):l.failure(e,n)}),l.identity)||this;return a._tag="EnumType",a.enum=n,a.enumValues=new Set(Object.values(n)),a}return(0,i.ZT)(n,e),n}(l.Type),f=function(e,n){return void 0===n&&(n="enum"),new g(e,n)}},22966:(e,n,t)=>{t.d(n,{ZX:()=>d,D$:()=>x});var a=t(70655),i=t(67294),r=t(41120),l=t(17812),o=t(92863),c=t(10529),u=r.Z((function(e){return{root:{padding:e.spacing(.5)}}}));function s(e){var n=e.direction,t=(0,a._T)(e,["direction"]),r=u();return i.createElement(l.Z,(0,a.pi)({className:r.root},t),i.createElement(o.Z,null,"chevron_".concat(n)))}function d(e){var n=e.page,t=e.pages,a=e.nextPage,r=e.prevPage;return t<=1?null:i.createElement(c.Z,{display:"flex",alignItems:"center"},i.createElement(s,{direction:"left",onClick:r,disabled:n<=1}),i.createElement(s,{direction:"right",onClick:a,disabled:n>=t}),i.createElement(c.Z,{ml:1.5},n," of ",t))}var m=t(97716),p=t(10180),g=t(20115),f=t(13646),k=t(19344),v=t(43363),E=t(68981),b=t(19324),Z=t(34314),h=function(e,n){return i.useMemo((function(){return null==e?e:n(e)}),[e,n])};var x=function(e,n){var t=void 0===n?{}:n,a=t.getItemId,r=void 0===a?m.Z:a,l=t.perPage,o=void 0===l?10:l,c=t.onChange,u=i.useState(1),s=u[0],d=u[1],x=i.useState(o),N=x[0],y=x[1],S=Math.max(1,Math.ceil(e.length/N)),C=i.useMemo((function(){return k.Z(v.Z(1,S),d)}),[S,d]),w=i.useCallback((function(){return C(s+1)}),[C,s]),D=i.useCallback((function(){return C(s-1)}),[C,s]);(function(e,n){void 0===n&&(n=m.Z);var t=h(e,n),a=(0,Z.Z)(e),i=h(a,n);return p.Z(Array,t)&&p.Z(Array,i)?!g.Z(i,t):!f.Z(t,i)})(e,h(r,E.Z))&&1!==s&&C(1);var I=(s-1)*N,F=i.useMemo((function(){return b.Z(I,I+N)}),[I,N]),B=h(e,F);return(0,Z.Z)(N,(function(e){e&&N!==e&&C(Math.floor((s-1)*e/N)+1)})),(0,Z.Z)(s,(function(e){s!==e&&c&&c(e,s)})),{paginated:B,total:e.length,from:I+1,to:I+N,perPage:N,setPerPage:y,page:s,pages:S,nextPage:w,prevPage:D,goToPage:C}}},77246:(e,n,t)=>{t.d(n,{Ex:()=>M,Fb:()=>F,Pl:()=>C,im:()=>A,o8:()=>I,tl:()=>j,xS:()=>_});var a=t(70655),i=t(94184),r=t.n(i),l=t(19344),o=t(57438),c=t(97716),u=t(51826),s=t(67294),d=t(868),m=t(17812),p=t(41120),g=t(28358),f=t(22318),k=t(83750),v=t(57394),E=t(88222),b=t(13258),Z=t(77256),h=t(95477),x=t(61657),N=t(59114),y=t(9001),S=function(e){return"asc"===e?"desc":"asc"};function C(e){var n=e.rows,t=(0,a._T)(e,["rows"]),i=s.useState(t.column),r=i[0],d=i[1],m=s.useState(t.direction||"asc"),p=m[0],g=m[1],f=r.sortBy||r.getValue,k=s.useMemo((function(){return l.Z(o.Z(f),"asc"===p?c.Z:u.Z)}),[f,p]),v=(0,y.Z)([k,n],(function(){return k(n)})),E=s.useCallback((function(e){r!==e?(d(e),g("asc")):g(S)}),[r,d,g]);return{column:r,direction:p,change:E,ordered:v}}var w=function(e){return e?s.createElement(d.ZP,{title:e.title,key:e.title},s.createElement(m.Z,{"aria-label":e.title,onClick:e.fn,href:e.href,component:e.href?"a":void 0,target:e.href?"_blank":void 0},e.icon)):null},D=p.Z((function(e){return{root:{paddingRight:e.spacing(1)},highlight:"light"===e.palette.type?{color:e.palette.secondary.main,backgroundColor:(0,N.$n)(e.palette.secondary.light,.85)}:{color:e.palette.text.primary,backgroundColor:e.palette.secondary.dark},spacer:{flex:"1 1 100%"},actions:{color:e.palette.text.secondary},title:{flex:"0 0 auto"}}}));function I(e){var n,t=e.heading,a=e.selected,i=void 0===a?0:a,l=e.actions,o=void 0===l?[]:l,c=e.selectedActions,u=void 0===c?[]:c,d=D();return s.createElement(g.Z,{className:r()(d.root,(n={},n[d.highlight]=i>0,n))},s.createElement("div",{className:d.title},i>0?s.createElement(f.Z,{color:"inherit",variant:"subtitle1"},i," selected"):s.createElement(f.Z,{variant:"h6"},t)),s.createElement("div",{className:d.spacer}),s.createElement("div",{className:d.actions},(i>0?u:o).map(w)))}function F(e){var n=e.columns,t=e.selection,a=void 0===t?void 0:t,i=e.ordering,r=e.withInlineActions,l=void 0!==r&&r;return s.createElement(k.Z,null,s.createElement(v.Z,null,!!a&&s.createElement(E.Z,{padding:"checkbox",onClick:a.toggleAll},s.createElement(b.Z,{indeterminate:a.selected.size>0&&a.selected.size<a.all.size,checked:a.selected.equals(a.all)})),n.map((function(e){return s.createElement(E.Z,{key:e.id,sortDirection:i.column===e&&i.direction,align:e.align},!1===e.sortable?e.label:s.createElement(d.ZP,{title:e.hint||"Sort",placement:"bottom-start",enterDelay:300},s.createElement(Z.Z,{active:i.column===e,direction:i.direction,onClick:function(){return i.change(e)}},e.label)))})),l&&s.createElement(E.Z,{align:"right"},"Actions")))}var B=p.Z({root:{overflowX:"auto"}});function A(e){var n=e.className,t=void 0===n?void 0:n,i=(0,a._T)(e,["className"]),l=B();return s.createElement("div",(0,a.pi)({className:r()(l.root,t)},i))}var T=p.Z((function(e){return{root:{opacity:.3,paddingRight:e.spacing(1),textAlign:"right",transition:"opacity 100ms",whiteSpace:"nowrap","tr:hover &":{opacity:1}}}}));function _(e){var n=e.actions,t=void 0===n?[]:n,i=e.children,r=void 0===i?void 0:i,l=(0,a._T)(e,["actions","children"]),o=T();return s.createElement("div",(0,a.pi)({className:o.root},l),t.map(w),r)}var P=p.Z((function(e){return{root:{marginBottom:e.spacing(2),marginLeft:e.spacing(3)}}}));function M(e){var n=P();return s.createElement(h.Z,(0,a.pi)({classes:n},e))}var V=p.Z((function(e){return{toolbar:{paddingRight:[e.spacing(1),"!important"]}}}));function j(e){var n=e.pagination,t=(0,a._T)(e,["pagination"]),i=V();return s.createElement(x.Z,(0,a.pi)({classes:i,component:"div",count:n.total,rowsPerPage:n.perPage,page:n.page-1,onChangePage:function(e,t){return n.goToPage(t+1)},onChangeRowsPerPage:function(e){return n.setPerPage(e.target.value)}},t))}}}]);
//# sourceMappingURL=5560.4d259203cfef6d212a64.chunk.js.map