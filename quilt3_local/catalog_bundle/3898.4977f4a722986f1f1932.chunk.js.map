{"version":3,"file":"3898.4977f4a722986f1f1932.chunk.js","mappings":"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","sources":["webpack://quilt-navigator/./app/components/ResponsiveSection/ResponsiveSection.js","webpack://quilt-navigator/./app/components/SearchResults/SearchResults.js","webpack://quilt-navigator/./app/utils/search.js"],"sourcesContent":["import * as M from '@material-ui/core'\n\nexport const Section = M.styled(M.Paper)(({ theme: t }) => ({\n  position: 'relative',\n  [t.breakpoints.down('xs')]: {\n    borderRadius: 0,\n    borderTop: `1px solid ${t.palette.divider}`,\n    padding: t.spacing(2),\n  },\n  [t.breakpoints.up('sm')]: {\n    marginTop: t.spacing(2),\n    padding: t.spacing(4),\n    paddingTop: t.spacing(3),\n  },\n}))\n\nexport const Heading = M.styled(M.Box)(({ theme: t }) => ({\n  ...t.typography.h6,\n  lineHeight: 1.4,\n  marginBottom: t.spacing(1),\n  [t.breakpoints.up('sm')]: {\n    marginBottom: t.spacing(2),\n  },\n  [t.breakpoints.up('md')]: {\n    ...t.typography.h5,\n  },\n}))\n","import cx from 'classnames'\nimport * as R from 'ramda'\nimport * as React from 'react'\nimport { Link } from 'react-router-dom'\nimport * as M from '@material-ui/core'\n\nimport { copyWithoutSpaces } from 'components/BreadCrumbs'\nimport JsonDisplay from 'components/JsonDisplay'\nimport Pagination from 'components/Pagination2'\nimport * as Preview from 'components/Preview'\nimport { Section, Heading } from 'components/ResponsiveSection'\nimport * as AWS from 'utils/AWS'\nimport AsyncResult from 'utils/AsyncResult'\nimport { useBucketExistence } from 'utils/BucketCache'\nimport * as Config from 'utils/Config'\nimport * as Data from 'utils/Data'\nimport Delay from 'utils/Delay'\nimport * as NamedRoutes from 'utils/NamedRoutes'\nimport StyledLink, { linkStyle } from 'utils/StyledLink'\nimport { getBreadCrumbs } from 'utils/s3paths'\nimport { readableBytes } from 'utils/string'\nimport usePrevious from 'utils/usePrevious'\n\nimport * as requests from 'containers/Bucket/requests'\n\nconst PER_PAGE = 10\nconst ES_V = '6.8'\nconst ES_REF = `https://www.elastic.co/guide/en/elasticsearch/reference/${ES_V}`\nconst ES_REF_SYNTAX = `${ES_REF}/query-dsl-query-string-query.html#query-string-syntax`\nconst ES_REF_WILDCARDS = `${ES_REF}/query-dsl-query-string-query.html#_wildcards`\n\nconst CrumbLink = M.styled(StyledLink)({ wordBreak: 'break-word' })\n\nfunction ObjectCrumbs({ handle, showBucket = false }) {\n  const { urls } = NamedRoutes.use()\n  const isDir = handle.key.endsWith('/')\n\n  const crumbs = React.useMemo(() => {\n    const all = getBreadCrumbs(handle.key)\n    const dirs = R.init(all).map(({ label, path }) => ({\n      to: urls.bucketFile(handle.bucket, path),\n      children: label,\n    }))\n    const file = {\n      to: urls.bucketFile(handle.bucket, handle.key, { version: handle.version }),\n      children: R.last(all).label,\n    }\n    const bucket = showBucket\n      ? {\n          to: urls.bucketRoot(handle.bucket),\n          children: handle.bucket,\n        }\n      : null\n    return { bucket, dirs, file }\n  }, [handle, urls, showBucket])\n\n  return (\n    <span onCopy={copyWithoutSpaces}>\n      <HeaderIcon title={isDir ? 'Directory' : 'File'}>\n        {isDir ? 'folder_open' : 'insert_drive_file'}\n      </HeaderIcon>\n      {crumbs.bucket && (\n        <>\n          <CrumbLink {...crumbs.bucket} />\n          &nbsp;/{' '}\n        </>\n      )}\n      {crumbs.dirs.map((c) => (\n        <React.Fragment key={`crumb:${c.to}`}>\n          <CrumbLink {...c} />\n          &nbsp;/{' '}\n        </React.Fragment>\n      ))}\n      <CrumbLink {...crumbs.file} />\n    </span>\n  )\n}\n\nfunction HeaderIcon(props) {\n  return (\n    <M.Box\n      component={M.Icon}\n      color=\"text.hint\"\n      mr={1}\n      style={{ verticalAlign: 'middle' }}\n      {...props}\n    />\n  )\n}\n\nfunction ObjectHeader({ handle, showBucket, downloadable = false }) {\n  return (\n    <Heading display=\"flex\" alignItems=\"center\" mb=\"0 !important\">\n      <ObjectCrumbs {...{ handle, showBucket }} />\n      <M.Box flexGrow={1} />\n      {!!downloadable &&\n        AWS.Signer.withDownloadUrl(handle, (url) => (\n          <M.Box\n            alignItems=\"center\"\n            display=\"flex\"\n            height={32}\n            justifyContent=\"center\"\n            width={24}\n            my={{ xs: -0.25, md: 0 }}\n          >\n            <M.IconButton href={url} title=\"Download\" download>\n              <M.Icon>arrow_downward</M.Icon>\n            </M.IconButton>\n          </M.Box>\n        ))}\n    </Heading>\n  )\n}\n\nfunction PackageHeader({ bucket, handle, hash, showBucket }) {\n  const { urls } = NamedRoutes.use()\n  return (\n    <Heading mb={1}>\n      <HeaderIcon title=\"Package\" component={M.SvgIcon} viewBox=\"-133 0 1264 1008\">\n        <path\n          fill=\"currentColor\"\n          d=\"M-2 918V446l1004 4v472c0 52-41 93-92 93H91c-52 0-93-43-93-97zM193 3h278v380H0c0-6 0-12 2-16L102 68c14-40 50-65 91-65zm709 63l100 299v2c2 4 2 8 2 12H534V1h277c41 0 77 25 91 65z\"\n        />\n      </HeaderIcon>\n      <span>\n        {!!showBucket && (\n          <>\n            <CrumbLink to={urls.bucketPackageList(bucket)}>{bucket}</CrumbLink>\n            &nbsp;/{' '}\n          </>\n        )}\n        <CrumbLink to={urls.bucketPackageTree(bucket, handle, hash)}>\n          {handle}\n          <M.Box component=\"span\" color=\"text.hint\">\n            @\n          </M.Box>\n          {R.take(10, hash)}\n        </CrumbLink>\n      </span>\n      <M.Box flexGrow={1} />\n    </Heading>\n  )\n}\n\nconst SmallerSection = ({ children }) => <M.Box mt={2}>{children}</M.Box>\n\nconst SectionHeading = ({ children, ...props }) => (\n  <M.Typography variant=\"h6\" {...props}>\n    {children}\n  </M.Typography>\n)\n\nconst Bold = ({ ...props }) => (\n  <M.Box\n    color=\"text.primary\"\n    fontWeight=\"fontWeightRegular\"\n    component=\"span\"\n    {...props}\n  />\n)\n\nconst Nowrap = M.styled('span')({ whiteSpace: 'nowrap' })\n\nconst useVersionInfoStyles = M.makeStyles((t) => ({\n  versionContainer: {\n    color: t.palette.text.secondary,\n    fontWeight: t.typography.fontWeightLight,\n  },\n  version: {\n    fontFamily: t.typography.monospace.fontFamily,\n    fontWeight: t.typography.fontWeightMedium,\n  },\n  seeOther: {\n    borderBottom: '1px dashed',\n    cursor: 'pointer',\n    ...linkStyle,\n  },\n}))\n\nfunction VersionInfo({ bucket, path, version, versions }) {\n  const classes = useVersionInfoStyles()\n  const { urls } = NamedRoutes.use()\n  const [versionsShown, setVersionsShown] = React.useState(false)\n  const toggleVersions = React.useCallback(() => {\n    setVersionsShown(!versionsShown)\n  }, [setVersionsShown, versionsShown])\n\n  const t = M.useTheme()\n  const xs = M.useMediaQuery(t.breakpoints.down('xs'))\n  const clip = (str, len) => {\n    const s = `${str}`\n    return xs ? s.substring(0, len) : s\n  }\n\n  return (\n    <M.Box mt={1}>\n      <M.Typography variant=\"subtitle1\" className={classes.versionContainer}>\n        <Nowrap>\n          Version{' '}\n          <StyledLink\n            to={urls.bucketFile(bucket, path, { version: version.id })}\n            className={classes.version}\n          >\n            {clip(version.id, 24)}\n          </StyledLink>\n        </Nowrap>{' '}\n        <Nowrap>\n          from <Bold>{version.updated.toLocaleString()}</Bold>\n          {' | '}\n          <Bold>{readableBytes(version.size)}</Bold>\n        </Nowrap>\n      </M.Typography>\n      {versions.length > 1 && (\n        <M.Typography>\n          {/* eslint-disable-next-line jsx-a11y/no-static-element-interactions, jsx-a11y/click-events-have-key-events */}\n          <span className={classes.seeOther} onClick={toggleVersions}>\n            {versionsShown ? 'hide ' : 'show '} all versions ({versions.length})\n          </span>\n        </M.Typography>\n      )}\n      {versions.length > 1 && versionsShown && (\n        <SmallerSection>\n          <SectionHeading gutterBottom>Versions ordered by relevance</SectionHeading>\n          {versions.map((v) => (\n            <M.Typography\n              key={`${v.updated.getTime()}:${v.id}`}\n              variant=\"body2\"\n              className={classes.versionContainer}\n            >\n              <StyledLink\n                to={urls.bucketFile(bucket, path, { version: v.id })}\n                className={classes.version}\n              >\n                {clip(v.id, 6)}\n              </StyledLink>\n              {' from '}\n              <Bold>{v.updated.toLocaleString()}</Bold>\n              {' | '}\n              {v.deleteMarker ? (\n                <Bold>Delete Marker</Bold>\n              ) : (\n                <Bold>{readableBytes(v.size)}</Bold>\n              )}\n            </M.Typography>\n          ))}\n        </SmallerSection>\n      )}\n    </M.Box>\n  )\n}\n\nconst usePreviewBoxStyles = M.makeStyles((t) => ({\n  root: {\n    border: `1px solid ${t.palette.grey[300]}`,\n    borderRadius: t.shape.borderRadius,\n    maxHeight: t.spacing(30),\n    marginTop: t.spacing(1),\n    minHeight: t.spacing(15),\n    padding: t.spacing(2),\n    position: 'relative',\n\n    '& img': {\n      marginLeft: 'auto',\n      marginRight: 'auto',\n    },\n\n    // workarounds to speed-up notebook preview rendering:\n    '&:not($expanded)': {\n      // hide overflow only when not expanded, using this while expanded\n      // slows down the page in chrome\n      overflow: 'hidden',\n\n      // only show 2 first cells unless expanded\n      '& .ipynb-preview .cell:nth-child(n+3)': {\n        display: 'none',\n      },\n    },\n  },\n  expanded: {\n    maxHeight: 'none',\n  },\n  fade: {\n    alignItems: 'flex-end',\n    background: `linear-gradient(to top,\n      rgba(255, 255, 255, 1),\n      rgba(255, 255, 255, 0.9),\n      rgba(255, 255, 255, 0.1),\n      rgba(255, 255, 255, 0.1)\n    )`,\n    bottom: 0,\n    cursor: 'pointer',\n    display: 'flex',\n    height: '100%',\n    justifyContent: 'center',\n    left: 0,\n    padding: t.spacing(1),\n    position: 'absolute',\n    width: '100%',\n    zIndex: 1,\n  },\n}))\n\nfunction PreviewBox({ children, title, expanded, onExpand }) {\n  const classes = usePreviewBoxStyles()\n  return (\n    <SmallerSection>\n      {title && <SectionHeading>{title}</SectionHeading>}\n\n      <div className={cx(classes.root, { [classes.expanded]: expanded })}>\n        {children}\n\n        {!expanded && (\n          <div className={classes.fade} onClick={onExpand}>\n            <M.Button variant=\"outlined\">Expand</M.Button>\n          </div>\n        )}\n      </div>\n    </SmallerSection>\n  )\n}\n\nconst previewOptions = { context: Preview.CONTEXT.LISTING }\n\nfunction PreviewDisplay({ handle, bucketExistenceData, versionExistenceData }) {\n  const [expanded, setExpanded] = React.useState(false)\n  const onExpand = React.useCallback(() => setExpanded(true), [setExpanded])\n  const renderContents = React.useCallback(\n    (children) => <PreviewBox {...{ children, expanded, onExpand }} />,\n    [expanded, onExpand],\n  )\n  const withData = (callback) =>\n    bucketExistenceData.case({\n      _: callback,\n      Err: () => callback(AsyncResult.Err(Preview.PreviewError.DoesNotExist({ handle }))),\n      Ok: () =>\n        versionExistenceData.case({\n          _: callback,\n          Err: (e) =>\n            callback(\n              AsyncResult.Err(\n                Preview.PreviewError.Unexpected({ handle, originalError: e }),\n              ),\n            ),\n          Ok: requests.ObjectExistence.case({\n            Exists: (h) => {\n              if (h.deleted) {\n                return callback(AsyncResult.Err(Preview.PreviewError.Deleted({ handle })))\n              }\n              if (h.archived) {\n                return callback(\n                  AsyncResult.Err(Preview.PreviewError.Archived({ handle })),\n                )\n              }\n              return Preview.load(handle, callback, previewOptions)\n            },\n            DoesNotExist: () =>\n              callback(AsyncResult.Err(Preview.PreviewError.InvalidVersion({ handle }))),\n          }),\n        }),\n    })\n\n  return withData(\n    Preview.display({\n      renderContents,\n      renderProgress: Progress,\n    }),\n  )\n}\n\nfunction Meta({ meta }) {\n  const [expanded, setExpanded] = React.useState(false)\n  const onExpand = React.useCallback(() => setExpanded(true), [setExpanded])\n  if (!meta || R.isEmpty(meta)) return null\n\n  return (\n    <PreviewBox title=\"Metadata\" expanded={expanded} onExpand={onExpand}>\n      <JsonDisplay defaultExpanded={1} value={meta} />\n    </PreviewBox>\n  )\n}\n\nconst useRevisionInfoStyles = M.makeStyles((t) => ({\n  revision: {\n    ...t.typography.subtitle1,\n    color: t.palette.text.secondary,\n    fontWeight: t.typography.fontWeightLight,\n    marginTop: t.spacing(2),\n  },\n  mono: {\n    fontFamily: t.typography.monospace.fontFamily,\n    fontWeight: t.typography.fontWeightMedium,\n  },\n  msg: {\n    ...t.typography.body2,\n    WebkitBoxOrient: 'vertical',\n    WebkitLineClamp: 2,\n    display: '-webkit-box',\n    marginTop: t.spacing(1),\n    overflow: 'hidden',\n    overflowWrap: 'break-word',\n    textOverflow: 'ellipsis',\n  },\n}))\n\nfunction RevisionInfo({ bucket, handle, hash, comment, lastModified }) {\n  const classes = useRevisionInfoStyles()\n  const { urls } = NamedRoutes.use()\n  return (\n    <M.Box>\n      <p className={classes.revision}>\n        <Nowrap>\n          Revision{' '}\n          <StyledLink\n            to={urls.bucketPackageTree(bucket, handle, hash)}\n            className={classes.mono}\n            title={hash}\n          >\n            {R.take(10, hash)}\n          </StyledLink>\n        </Nowrap>{' '}\n        <Nowrap>\n          from <Bold>{lastModified.toLocaleString()}</Bold>\n        </Nowrap>\n      </p>\n      <p className={classes.msg}>{comment || <i>No message</i>}</p>\n    </M.Box>\n  )\n}\n\nfunction ObjectHit({ hit, ...props }) {\n  const Component = hit.path.endsWith('/') ? DirHit : FileHit\n  return <Component {...{ hit, ...props }} />\n}\n\nfunction FileHit({ showBucket, hit: { path, versions, bucket } }) {\n  const cfg = Config.use()\n  const s3 = AWS.S3.use()\n\n  const v = versions[0]\n  const handle = { bucket, key: path, version: v.id }\n\n  const bucketExistenceData = useBucketExistence(bucket)\n  const versionExistenceData = Data.use(requests.getObjectExistence, { s3, ...handle })\n\n  const downloadable =\n    !cfg.noDownload &&\n    bucketExistenceData.case({\n      _: () => false,\n      Ok: () =>\n        versionExistenceData.case({\n          _: () => false,\n          Ok: requests.ObjectExistence.case({\n            _: () => false,\n            Exists: ({ deleted, archived }) => !deleted && !archived,\n          }),\n        }),\n    })\n\n  return (\n    <Section\n      data-testid=\"search-hit\"\n      data-search-hit-type=\"file\"\n      data-search-hit-bucket={bucket}\n      data-search-hit-path={path}\n    >\n      <ObjectHeader {...{ handle, showBucket, downloadable }} />\n      <VersionInfo bucket={bucket} path={path} version={v} versions={versions} />\n      <Meta meta={v.meta} />\n      <PreviewDisplay {...{ handle, bucketExistenceData, versionExistenceData }} />\n    </Section>\n  )\n}\n\nfunction DirHit({\n  showBucket,\n  hit: {\n    path,\n    versions: [v],\n    bucket,\n  },\n}) {\n  const handle = { bucket, key: path }\n  return (\n    <Section\n      data-testid=\"search-hit\"\n      data-search-hit-type=\"dir\"\n      data-search-hit-bucket={bucket}\n      data-search-hit-path={path}\n    >\n      <ObjectHeader {...{ handle, showBucket }} />\n      <Meta meta={v.meta} />\n    </Section>\n  )\n}\n\nfunction PackageHit({\n  showBucket,\n  hit: { bucket, handle, hash, lastModified, meta, tags, comment },\n}) {\n  return (\n    <Section\n      data-testid=\"search-hit\"\n      data-search-hit-type=\"package\"\n      data-search-hit-bucket={bucket}\n      data-search-hit-package-name={handle}\n      data-search-hit-package-hash={hash}\n    >\n      <PackageHeader {...{ handle, bucket, hash, showBucket }} />\n      <RevisionInfo {...{ bucket, handle, hash, comment, lastModified }} />\n      {tags && tags.length > 0 && (\n        <M.Box mt={2}>\n          {tags.map((t) => (\n            <React.Fragment key={t}>\n              <M.Chip variant=\"outlined\" size=\"small\" label={t} />{' '}\n            </React.Fragment>\n          ))}\n        </M.Box>\n      )}\n      <Meta meta={meta} />\n    </Section>\n  )\n}\n\nexport function Hit(props) {\n  const Component = props.hit.type === 'package' ? PackageHit : ObjectHit\n  return <Component {...props} />\n}\n\nexport function Hits({\n  hits,\n  page,\n  scrollRef,\n  makePageUrl,\n  perPage = PER_PAGE,\n  showBucket,\n}) {\n  const actualPage = page || 1\n  const pages = Math.ceil(hits.length / perPage)\n\n  const paginated = React.useMemo(\n    () =>\n      pages === 1 ? hits : hits.slice((actualPage - 1) * perPage, actualPage * perPage),\n    [hits, actualPage, perPage, pages],\n  )\n\n  usePrevious(actualPage, (prev) => {\n    if (prev && actualPage !== prev && scrollRef.current) {\n      scrollRef.current.scrollIntoView()\n    }\n  })\n\n  return (\n    <>\n      {paginated.map((hit) => (\n        <Hit key={hit.key} hit={hit} showBucket={showBucket} />\n      ))}\n      {pages > 1 && <Pagination {...{ pages, page: actualPage, makePageUrl }} />}\n    </>\n  )\n}\n\nconst useAltStyles = M.makeStyles((t) => ({\n  root: {\n    paddingTop: t.spacing(3),\n    [t.breakpoints.down('xs')]: {\n      borderTop: `1px solid ${t.palette.divider}`,\n      paddingLeft: t.spacing(2),\n      paddingRight: t.spacing(2),\n    },\n  },\n}))\n\nexport function Alt({ className, ...props }) {\n  const classes = useAltStyles()\n  return <M.Box className={cx(className, classes.root)} {...props} />\n}\n\nexport function Progress({ children }) {\n  return (\n    <Alt>\n      <Delay alwaysRender>\n        {(ready) => (\n          <M.Fade in={ready}>\n            <M.Box display=\"flex\" alignItems=\"center\">\n              <M.Box pr={2}>\n                <M.CircularProgress size={24} />\n              </M.Box>\n              <M.Typography variant=\"body1\">{children}</M.Typography>\n            </M.Box>\n          </M.Fade>\n        )}\n      </Delay>\n    </Alt>\n  )\n}\n\nexport const handleErr = (retryUrl) => (e) =>\n  (\n    <Alt>\n      <M.Typography variant=\"h5\" gutterBottom>\n        {e.message === 'SearchSyntaxError' ? ( // eslint-disable-line no-nested-ternary\n          <>Search syntax error</>\n        ) : e.message === 'Timeout' ? (\n          <>Query timed out</>\n        ) : (\n          <>Search error</>\n        )}\n      </M.Typography>\n      {e.message === 'SearchSyntaxError' ? ( // eslint-disable-line no-nested-ternary\n        <M.Typography gutterBottom>\n          Oops, couldn&apos;t parse that search. Try quoting your query or read about{' '}\n          <StyledLink href={ES_REF_SYNTAX} target=\"_blank\">\n            supported query syntax\n          </StyledLink>\n          .\n          {!!retryUrl && (\n            <> You can also click RETRY to try a simplified version of your query.</>\n          )}\n        </M.Typography>\n      ) : e.message === 'Timeout' ? (\n        <M.Typography gutterBottom>\n          That made ElasticSearch sweat. Try{' '}\n          <StyledLink href={ES_REF_WILDCARDS} target=\"_blank\">\n            avoiding wildcards\n          </StyledLink>{' '}\n          or ask Quilt about scaling your cluster.\n        </M.Typography>\n      ) : (\n        <M.Typography gutterBottom>\n          ElasticSearch had trouble with that query. The cluster may be busy indexing new\n          documents. Try again later\n          {!!retryUrl && <> or click RETRY to try a simplified version of your query</>}.\n        </M.Typography>\n      )}\n      {!!e.status && <M.Typography>Status: {e.status}</M.Typography>}\n      {!!e.code && <M.Typography>Code: {e.code}</M.Typography>}\n      {!!e.details && (\n        <>\n          <M.Typography>Error details:</M.Typography>\n          <M.Typography style={{ whiteSpace: 'pre' }}>{e.details}</M.Typography>\n        </>\n      )}\n      {!!retryUrl && (\n        <M.Box pt={2}>\n          <M.Button component={Link} to={retryUrl} color=\"primary\" variant=\"contained\">\n            Retry simplified query\n          </M.Button>\n        </M.Box>\n      )}\n    </Alt>\n  )\n\nexport function NothingFound({ children }) {\n  return (\n    <Alt>\n      <M.Typography variant=\"body1\">\n        We have not found anything matching your query\n      </M.Typography>\n      {children}\n    </Alt>\n  )\n}\n","import * as FP from 'fp-ts'\nimport * as R from 'ramda'\nimport * as React from 'react'\n\nimport * as APIConnector from 'utils/APIConnector'\nimport * as BucketConfig from 'utils/BucketConfig'\nimport { BaseError } from 'utils/error'\nimport mkSearch from 'utils/mkSearch'\n\nexport class SearchError extends BaseError {}\n\nconst parseDate = (d) => d && new Date(d)\n\nconst PACKAGES_SUFFIX = '_packages'\n\n/*\nFile: {\n  key: str,\n  type: 'object',\n  score: num,\n  bucket: str,\n  path: str,\n  versions: [\n    {\n      id: str,\n      score: num,\n      updated: ?Date,\n      lastModified: ?Date,\n      size: num,\n      meta: str,\n    },\n  ],\n}\n\nPackage: {\n  key: str,\n  type: 'package',\n  score: num,\n  bucket: str,\n  handle: str,\n  hash: str,\n  lastModified: ?Date,\n  meta: str, // should it be parsed?\n}\n*/\n\nconst getTypeAndBucketFromIndex = (idx) => {\n  const i = idx.lastIndexOf('-reindex-')\n  const idxNormalized = i === -1 ? idx : idx.slice(0, i)\n  const suffixIdx = idxNormalized.lastIndexOf(PACKAGES_SUFFIX)\n  return suffixIdx === -1\n    ? { type: 'object', bucket: idxNormalized }\n    : { type: 'package', bucket: idxNormalized.slice(0, suffixIdx) }\n}\n\nconst extractObjData = ({ bucket, score, src }) => {\n  const key = `object:${bucket}/${src.key}`\n  return {\n    [key]: {\n      key,\n      type: 'object',\n      score,\n      bucket,\n      path: src.key,\n      versions: [\n        {\n          id: src.version_id,\n          score,\n          updated: parseDate(src.updated),\n          lastModified: parseDate(src.last_modified),\n          size: src.size,\n          meta: src.user_meta,\n          deleteMarker: src.delete_marker,\n        },\n      ],\n    },\n  }\n}\n\nconst parseJSON = (s) => {\n  try {\n    return JSON.parse(s)\n  } catch (e) {\n    return s\n  }\n}\n\nconst extractPkgData = ({ bucket, score, src }) => {\n  if (src.delete_marker || !src.hash) return {}\n  const key = `package:${bucket}/${src.handle}:${src.hash}`\n  return {\n    [key]: {\n      key,\n      type: 'package',\n      bucket,\n      score,\n      handle: src.handle,\n      hash: src.hash,\n      lastModified: parseDate(src.last_modified),\n      meta: parseJSON(src.metadata),\n      // tags: src.tags, // TODO: currently not provided\n      comment: src.comment,\n    },\n  }\n}\n\nconst extractData = ({ _score: score, _source: src, _index: idx }) => {\n  const { type, bucket } = getTypeAndBucketFromIndex(idx)\n  const extract = type === 'object' ? extractObjData : extractPkgData\n  return extract({ bucket, score, src })\n}\n\nconst takeR = (_l, r) => r\n\nconst mkMerger = (cases) => (key, l, r) => (cases[key] || takeR)(l, r)\n\nconst mergeHits = R.mergeDeepWithKey(\n  mkMerger({\n    score: R.max,\n    versions: R.pipe(\n      R.concat,\n      R.sortBy((v) => -v.score),\n    ),\n  }),\n)\n\nconst mergeAllHits = R.pipe(\n  R.reduce((acc, hit) => mergeHits(acc, extractData(hit)), {}),\n  R.values,\n  R.sortBy((h) => -h.score),\n)\n\nconst unescape = (s) => s.replace(/\\\\n/g, '\\n')\n\nexport default function useSearch() {\n  const req = APIConnector.use()\n  const bucketConfigs = BucketConfig.useRelevantBucketConfigs()\n  const allBuckets = React.useMemo(\n    () => bucketConfigs.map((b) => b.name),\n    [bucketConfigs],\n  )\n\n  return React.useCallback(\n    async ({\n      query,\n      buckets = [],\n      mode = 'all', // all | objects | packages\n      retry,\n    }) => {\n      const index = FP.function.pipe(\n        buckets.length ? buckets : allBuckets,\n        R.chain((b) => {\n          const idxs = []\n          if (mode === 'objects' || mode === 'all') {\n            idxs.push(b)\n          }\n          if (mode === 'packages' || mode === 'all') {\n            idxs.push(`${b}${PACKAGES_SUFFIX}`)\n          }\n          return idxs\n        }),\n        R.join(','),\n      )\n      try {\n        const qs = mkSearch({ index, action: 'search', query, retry })\n        const result = await req(`/search${qs}`)\n        const hits = mergeAllHits(result.hits.hits)\n        return { hits, total: result.hits.total }\n      } catch (e) {\n        if (e instanceof APIConnector.HTTPError) {\n          const match = e.text.match(/^RequestError\\((\\d+), '(\\w+)', '(.+)'\\)$/)\n          if (match) {\n            const code = match[2]\n            const details = unescape(match[3])\n\n            if (code === 'search_phase_execution_exception') {\n              throw new SearchError('SearchSyntaxError', { details })\n            }\n\n            throw new SearchError('RequestError', {\n              code,\n              details,\n              status: parseInt(match[1], 10) || undefined,\n            })\n          }\n          if (e.text && /^ConnectionTimeout/.test(e.text)) {\n            throw new SearchError('Timeout')\n          }\n        }\n        // eslint-disable-next-line no-console\n        console.log('Search error:')\n        // eslint-disable-next-line no-console\n        console.error(e)\n        throw new SearchError('Unexpected', { originalError: e })\n      }\n    },\n    [req, allBuckets],\n  )\n}\n"],"names":["Section","t","position","breakpoints","down","borderRadius","borderTop","palette","divider","padding","spacing","up","marginTop","paddingTop","Heading","typography","h6","lineHeight","marginBottom","h5","ES_REF","ES_REF_SYNTAX","ES_REF_WILDCARDS","CrumbLink","StyledLink","wordBreak","ObjectCrumbs","handle","showBucket","urls","NamedRoutes","isDir","key","endsWith","crumbs","all","dirs","map","label","path","to","bucketFile","bucket","children","file","version","bucketRoot","onCopy","HeaderIcon","title","c","props","component","color","mr","style","verticalAlign","ObjectHeader","downloadable","display","alignItems","mb","flexGrow","AWS","url","height","justifyContent","width","my","xs","md","href","download","PackageHeader","hash","viewBox","fill","d","bucketPackageList","bucketPackageTree","SmallerSection","mt","SectionHeading","variant","Bold","fontWeight","Nowrap","whiteSpace","useVersionInfoStyles","versionContainer","text","secondary","fontWeightLight","fontFamily","monospace","fontWeightMedium","seeOther","borderBottom","cursor","VersionInfo","versions","classes","versionsShown","setVersionsShown","toggleVersions","clip","str","len","s","substring","className","id","updated","toLocaleString","size","length","onClick","gutterBottom","v","getTime","deleteMarker","usePreviewBoxStyles","root","border","grey","shape","maxHeight","minHeight","marginLeft","marginRight","overflow","expanded","fade","background","bottom","left","zIndex","PreviewBox","onExpand","previewOptions","context","Preview","PreviewDisplay","callback","bucketExistenceData","versionExistenceData","setExpanded","renderContents","renderProgress","Progress","case","_","Err","AsyncResult","Ok","e","originalError","requests","Exists","h","deleted","archived","DoesNotExist","Meta","meta","JsonDisplay","defaultExpanded","value","useRevisionInfoStyles","revision","subtitle1","mono","msg","body2","WebkitBoxOrient","WebkitLineClamp","overflowWrap","textOverflow","RevisionInfo","comment","lastModified","ObjectHit","hit","Component","DirHit","FileHit","cfg","Config","s3","S3","use","Data","noDownload","PackageHit","tags","Hit","type","Hits","hits","page","scrollRef","makePageUrl","perPage","actualPage","pages","Math","ceil","paginated","slice","usePrevious","prev","current","scrollIntoView","useAltStyles","paddingLeft","paddingRight","Alt","Delay","alwaysRender","ready","in","pr","handleErr","retryUrl","message","target","status","code","details","pt","Link","NothingFound","cases","parseDate","Date","PACKAGES_SUFFIX","extractObjData","score","src","version_id","last_modified","user_meta","delete_marker","parseJSON","JSON","parse","extractPkgData","metadata","extractData","idx","i","lastIndexOf","idxNormalized","suffixIdx","getTypeAndBucketFromIndex","takeR","_l","r","mergeHits","l","mergeAllHits","acc","useSearch","req","bucketConfigs","allBuckets","b","name","query","buckets","mode","retry","index","idxs","push","qs","action","result","total","match","replace","SearchError","parseInt","undefined","test","console","log","error"],"sourceRoot":""}