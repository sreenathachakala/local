{"version":3,"file":"embed.d14297e20a2c1b8d6c7b.js","mappings":"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","sources":["webpack://quilt-navigator/./app/embed/Overrides.tsx","webpack://quilt-navigator/./app/embed/ipc.ts","webpack://quilt-navigator/./app/embed/EmbedConfig.js","webpack://quilt-navigator/./app/constants/embed-routes.js","webpack://quilt-navigator/./app/embed/AppBar.js","webpack://quilt-navigator/./app/embed/Embed.js","webpack://quilt-navigator/./app/embed/index.js"],"sourcesContent":["import template from 'lodash/template'\nimport * as R from 'ramda'\nimport * as React from 'react'\n\n// XXX: consider using io-ts\ninterface S3ObjectLinkOverride {\n  title?: React.ReactNode\n  href?: (ctx: {\n    url: string\n    s3HttpsUri: string\n    bucket: string\n    // TODO: add encoded key?\n    key: string\n    version: string\n  }) => string\n  notification?: React.ReactNode\n  emit?: 'notify' | 'override'\n}\n\ninterface Overrides {\n  s3ObjectLink?: S3ObjectLinkOverride\n}\n\nexport const Context = React.createContext<Overrides>({})\nContext.displayName = 'Overrides'\n\nexport const { Provider } = Context\n\nfunction merge<L extends any, R extends any>(l: L, r: R) {\n  return l ?? r\n}\n\nexport function useOverrides(defaults?: Overrides): Overrides {\n  const overrides = React.useContext(Context)\n  return React.useMemo(\n    () => compile(R.mergeDeepWith(merge, overrides, defaults || {})),\n    [defaults, overrides],\n  )\n}\n\nexport { useOverrides as use }\n\nfunction assertIsObject(scope: string, obj: unknown): asserts obj is object {\n  if (obj != null && typeof obj !== 'object') {\n    throw new Error(`${scope} must be an object if present`)\n  }\n}\n\nconst compileTemplate = (scope?: string) => (str?: unknown) => {\n  try {\n    return typeof str === 'string'\n      ? template(str)\n      : (str as NonNullable<Overrides['s3ObjectLink']>['href'])\n  } catch (e) {\n    if (scope && e instanceof Error) {\n      throw new Error(`${scope} must be a valid template string: ${e.message}`)\n    }\n    throw e\n  }\n}\n\nfunction validateEmit(v: unknown) {\n  if (!v) return undefined\n  if (v !== 'notify' && v !== 'override') {\n    throw new Error(\n      '.overrides.s3ObjectLink.emit must be either \"notify\" or \"override\" or some falsy value',\n    )\n  }\n  return v\n}\n\nconst compile = R.evolve({\n  s3ObjectLink: { href: compileTemplate(), emit: validateEmit },\n})\n\nexport function validate(input: unknown) {\n  assertIsObject('.overrides', input)\n  assertIsObject('.overrides.s3ObjectLink', (input as any)?.s3ObjectLink)\n  R.evolve({\n    s3ObjectLink: {\n      href: compileTemplate('.overrides.s3ObjectLink.href'),\n      emit: validateEmit,\n    },\n  })(input)\n}\n","import * as React from 'react'\n\nimport parseSearch from 'utils/parseSearch'\n\nconst getParamOr = (param: string | string[] | undefined, fallback: string) =>\n  (Array.isArray(param) ? param[0] : param) || fallback\n\nconst EVENT_SOURCE = 'quilt-embed'\nconst search = parseSearch(window.location.search)\nconst NONCE = getParamOr(search.nonce, `${Math.random}`)\nconst PARENT_ORIGIN = getParamOr(search.origin, '*')\n\nexport function useMessageParent() {\n  return React.useCallback((data: object) => {\n    window.parent.postMessage(\n      { source: EVENT_SOURCE, nonce: NONCE, ...data },\n      PARENT_ORIGIN,\n    )\n  }, [])\n}\n\nexport function useMessageHandler(fn: (data: object) => void) {\n  const handleMessage = React.useCallback(\n    (e: MessageEvent) => {\n      if (\n        e.source !== window.parent ||\n        (PARENT_ORIGIN !== '*' && e.origin !== PARENT_ORIGIN) ||\n        !e.data?.type\n      )\n        return\n      fn(e.data)\n    },\n    [fn],\n  )\n\n  React.useEffect(() => {\n    window.addEventListener('message', handleMessage)\n    return () => {\n      window.removeEventListener('message', handleMessage)\n    }\n  }, [handleMessage])\n}\n","import * as React from 'react'\n\nconst Ctx = React.createContext({})\n\nfunction EmbedConfigProvider({ config, children }) {\n  return <Ctx.Provider value={config}>{children}</Ctx.Provider>\n}\n\nfunction useEmbedConfig() {\n  return React.useContext(Ctx)\n}\n\nexport { EmbedConfigProvider as Provider, useEmbedConfig as use }\n","import { mkSearch } from 'utils/NamedRoutes'\nimport { encode } from 'utils/s3paths'\n\nexport const bucketRoot = {\n  path: '/b/:bucket',\n  url: (bucket) => `/b/${bucket}`,\n}\nexport const bucketFile = {\n  path: '/b/:bucket/tree/:path(.*[^/])',\n  url: (bucket, path, version) =>\n    `/b/${bucket}/tree/${encode(path)}${mkSearch({ version })}`,\n}\nexport const bucketDir = {\n  path: '/b/:bucket/tree/:path(.+/)?',\n  // eslint-disable-next-line @typescript-eslint/default-param-last\n  url: (bucket, path = '', prefix) =>\n    `/b/${bucket}/tree/${encode(path)}${mkSearch({ prefix: prefix || undefined })}`,\n}\nexport const bucketSearch = {\n  path: '/b/:bucket/search',\n  url: (bucket, { q, p, retry }) => `/b/${bucket}/search${mkSearch({ q, p, retry })}`,\n}\n","import { basename } from 'path'\n\nimport * as React from 'react'\nimport { useHistory, useRouteMatch, Link } from 'react-router-dom'\nimport * as M from '@material-ui/core'\nimport { fade } from '@material-ui/core/styles/colorManipulator'\n\nimport * as NamedRoutes from 'utils/NamedRoutes'\nimport parse from 'utils/parseSearch'\nimport { useRoute } from 'utils/router'\n\nimport * as EmbedConfig from './EmbedConfig'\n\nconst useSearchBoxStyles = M.makeStyles((t) => ({\n  root: {\n    background: fade(t.palette.common.white, 0.1),\n    borderRadius: t.shape.borderRadius,\n    color: t.palette.common.white,\n    overflow: 'hidden',\n    position: 'absolute',\n    right: 0,\n    transition: ['background-color 200ms', 'width 200ms'],\n    width: t.spacing(24),\n    '&:hover': {\n      background: fade(t.palette.common.white, 0.2),\n    },\n  },\n  focused: {\n    background: `${fade(t.palette.common.white, 0.2)} !important`,\n    width: '100%',\n  },\n  input: {\n    paddingLeft: t.spacing(4),\n    paddingTop: 8,\n    paddingBottom: 9,\n    textOverflow: 'ellipsis',\n  },\n  adornment: {\n    cursor: 'pointer',\n    justifyContent: 'center',\n    pointerEvents: 'none',\n    position: 'absolute',\n    width: t.spacing(4),\n  },\n}))\n\nfunction SearchBox({ bucket }) {\n  const history = useHistory()\n  const { paths, urls } = NamedRoutes.use()\n\n  const { location: l, match } = useRoute(paths.bucketSearch)\n  const query = (match && parse(l.search).q) || ''\n\n  const makeUrl = React.useCallback(\n    (q) => urls.bucketSearch(bucket, { q }),\n    [urls, bucket],\n  )\n\n  const [value, change] = React.useState(null)\n  const [focused, setFocused] = React.useState(false)\n\n  const handleChange = React.useCallback(\n    (evt) => {\n      change(evt.target.value)\n    },\n    [change],\n  )\n\n  const handleKeyDown = React.useCallback(\n    (evt) => {\n      // eslint-disable-next-line default-case\n      switch (evt.key) {\n        case 'Enter':\n          if (query !== value) {\n            history.push(makeUrl(value))\n          }\n          evt.target.blur()\n          break\n        case 'Escape':\n          evt.target.blur()\n          break\n      }\n    },\n    [history, makeUrl, value, query],\n  )\n\n  const handleFocus = React.useCallback(() => {\n    change(query)\n    setFocused(true)\n  }, [query, change, setFocused])\n\n  const handleBlur = React.useCallback(() => {\n    change(null)\n    setFocused(false)\n  }, [change, setFocused])\n\n  const { adornment, ...classes } = useSearchBoxStyles()\n\n  return (\n    <M.InputBase\n      value={value === null ? query : value}\n      startAdornment={\n        <M.InputAdornment className={adornment}>\n          <M.Icon>search</M.Icon>\n        </M.InputAdornment>\n      }\n      classes={classes}\n      placeholder={focused ? `Search s3://${bucket}` : 'Search'}\n      onChange={handleChange}\n      onFocus={handleFocus}\n      onBlur={handleBlur}\n      onKeyDown={handleKeyDown}\n    />\n  )\n}\n\nconst useStyles = M.makeStyles((t) => ({\n  appBar: {\n    zIndex: t.zIndex.appBar + 1,\n  },\n  btn: {\n    color: t.palette.common.white,\n    backgroundColor: fade(t.palette.common.white, 0.1),\n    '&:hover': {\n      backgroundColor: fade(t.palette.common.white, 0.2),\n      // Reset on touch devices, it doesn't add specificity\n      '@media (hover: none)': {\n        backgroundColor: fade(t.palette.common.white, 0.1),\n      },\n    },\n  },\n}))\n\nexport default function AppBar({ bucket }) {\n  const cfg = EmbedConfig.use()\n  const trigger = M.useScrollTrigger()\n  const classes = useStyles()\n  const { urls, paths } = NamedRoutes.use()\n  const isSearch = !!useRouteMatch(paths.bucketSearch)\n  const rootUrl = urls.bucketDir(bucket, cfg.scope)\n  const showRootLink = !cfg.hideRootLink || isSearch\n  return (\n    <>\n      <M.Toolbar />\n      <M.Slide appear={false} direction=\"down\" in={!trigger}>\n        <M.AppBar className={classes.appBar}>\n          <M.Toolbar disableGutters>\n            <M.Container maxWidth=\"lg\" style={{ display: 'flex' }}>\n              {showRootLink && (\n                <M.Button\n                  to={rootUrl}\n                  component={Link}\n                  variant=\"contained\"\n                  className={classes.btn}\n                >\n                  {cfg.hideRootLink && isSearch ? ( // eslint-disable-line no-nested-ternary\n                    <>\n                      <M.Icon style={{ fontSize: 16, marginLeft: -2 }}>\n                        arrow_back_ios\n                      </M.Icon>{' '}\n                      Back\n                    </>\n                  ) : cfg.scope ? (\n                    basename(cfg.scope)\n                  ) : (\n                    `s3://${bucket}`\n                  )}\n                </M.Button>\n              )}\n              <M.Box\n                display=\"flex\"\n                alignItems=\"center\"\n                position=\"relative\"\n                flexGrow={1}\n                ml={showRootLink ? 2 : undefined}\n              >\n                <SearchBox bucket={bucket} />\n              </M.Box>\n            </M.Container>\n          </M.Toolbar>\n        </M.AppBar>\n      </M.Slide>\n    </>\n  )\n}\n","// Embed entry point\n\n// Import all the third party stuff\nimport { createMemoryHistory as createHistory } from 'history'\nimport * as R from 'ramda'\nimport * as React from 'react'\nimport * as redux from 'react-redux'\nimport { Route, Switch, useLocation } from 'react-router-dom'\nimport * as M from '@material-ui/core'\n\n// initialize config from window.QUILT_CATALOG_CONFIG\nimport cfg from 'constants/config'\n\n// init Sentry before importing other modules\n// to allow importing it directly in other modules and capturing errors\nimport * as Sentry from 'utils/Sentry'\n\nSentry.init(cfg)\n\n// side-effect: inject global css\nimport 'sanitize.css'\n\n// Import the rest of our modules\nimport * as Layout from 'components/Layout'\nimport Placeholder from 'components/Placeholder'\nimport * as Auth from 'containers/Auth'\nimport { ThrowNotFound, createNotFound } from 'containers/NotFoundPage'\nimport * as Notifications from 'containers/Notifications'\nimport * as routes from 'constants/embed-routes'\nimport * as style from 'constants/style'\nimport * as APIConnector from 'utils/APIConnector'\nimport * as AWS from 'utils/AWS'\nimport * as BucketCache from 'utils/BucketCache'\nimport { createBoundary } from 'utils/ErrorBoundary'\nimport { GraphQLProvider } from 'utils/GraphQL'\nimport * as NamedRoutes from 'utils/NamedRoutes'\nimport * as Cache from 'utils/ResourceCache'\nimport * as Store from 'utils/Store'\nimport defer from 'utils/defer'\nimport { ErrorDisplay } from 'utils/error'\nimport * as RT from 'utils/reactTools'\nimport RouterProvider from 'utils/router'\nimport * as s3paths from 'utils/s3paths'\nimport useConstant from 'utils/useConstant'\nimport useMemoEq from 'utils/useMemoEq'\nimport usePrevious from 'utils/usePrevious'\n\n// TODO: consider reimplementing these locally or moving to some shared location\nimport { displayError } from 'containers/Bucket/errors'\n\nimport WithGlobalStyles from '../global-styles'\n\nimport AppBar from './AppBar'\nimport * as EmbedConfig from './EmbedConfig'\nimport * as Overrides from './Overrides'\nimport * as ipc from './ipc'\n\nconst SuspensePlaceholder = () => <Placeholder color=\"text.secondary\" />\n\nconst Dir = RT.mkLazy(() => import('./Dir'), SuspensePlaceholder)\nconst File = RT.mkLazy(() => import('./File'), SuspensePlaceholder)\nconst Search = RT.mkLazy(() => import('./Search'), SuspensePlaceholder)\n\nconst FinalBoundary = createBoundary(() => (error) => (\n  <h1\n    style={{\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      height: 400,\n      maxHeight: '90vh',\n      fontFamily: 'sans-serif',\n      margin: 0,\n    }}\n  >\n    {error.headline || 'Something went wrong'}\n  </h1>\n))\n\nfunction StyledError({ children }) {\n  return (\n    <M.Box\n      display=\"flex\"\n      alignItems=\"center\"\n      justifyContent=\"center\"\n      height={400}\n      maxHeight=\"90vh\"\n      textAlign=\"center\"\n    >\n      <M.Typography variant=\"h3\">{children}</M.Typography>\n    </M.Box>\n  )\n}\n\nconst ErrorBoundary = createBoundary(() => (error) => (\n  <StyledError>{error.headline || 'Something went wrong'}</StyledError>\n))\n\nconst CatchNotFound = createNotFound(() => <StyledError>Page not found</StyledError>)\n\nfunction Root() {\n  const l = useLocation()\n  const { paths } = NamedRoutes.use()\n  return (\n    <CatchNotFound id={`${l.pathname}${l.search}${l.hash}`}>\n      <Switch>\n        <Route path={paths.bucketRoot} component={Bucket} />\n        <Route component={ThrowNotFound} />\n      </Switch>\n    </CatchNotFound>\n  )\n}\n\nfunction Bucket({\n  match: {\n    params: { bucket },\n  },\n}) {\n  const { paths } = NamedRoutes.use()\n\n  return (\n    <BucketLayout bucket={bucket}>\n      <Switch>\n        <Route path={paths.bucketFile} component={File} exact strict />\n        <Route path={paths.bucketDir} component={Dir} exact />\n        <Route path={paths.bucketSearch} component={Search} exact />\n        <Route component={ThrowNotFound} />\n      </Switch>\n    </BucketLayout>\n  )\n}\n\nfunction BucketLayout({ bucket, children }) {\n  const data = BucketCache.useBucketExistence(bucket)\n  return (\n    <>\n      <AppBar bucket={bucket} />\n      <M.Container maxWidth=\"lg\">\n        {data.case({\n          Ok: () => children,\n          Err: displayError(),\n          _: () => <Placeholder color=\"text.secondary\" />,\n        })}\n      </M.Container>\n      <M.Box flexGrow={1} />\n    </>\n  )\n}\n\nfunction useInit() {\n  const messageParent = ipc.useMessageParent()\n  const [state, setState] = React.useState(null)\n\n  ipc.useMessageHandler(\n    React.useCallback(\n      ({ type, ...init }) => {\n        if (type !== 'init') return\n        try {\n          if (!init.bucket && !init.route)\n            throw new Error('missing either .bucket or .route')\n          if (init.scope) {\n            if (typeof init.scope !== 'string') throw new Error('.scope must be a string')\n            // eslint-disable-next-line no-param-reassign\n            init.scope = s3paths.ensureSlash(init.scope)\n          }\n          Overrides.validate(init.overrides)\n          setState(init)\n        } catch (e) {\n          const message = `Configuration error: ${e.message}`\n          // eslint-disable-next-line no-console\n          console.error(message)\n          // eslint-disable-next-line no-console\n          console.log('init object:', init)\n          messageParent({ type: 'error', message, init })\n          setState(e)\n        }\n      },\n      [setState, messageParent],\n    ),\n  )\n\n  React.useEffect(() => {\n    messageParent({ type: 'ready' })\n  }, [messageParent])\n\n  return state\n}\n\nfunction Init() {\n  const [key, setKey] = React.useState(0)\n  const init = useInit()\n  usePrevious(init, (prev) => {\n    if (init !== prev) {\n      setKey((k) => k + 1)\n    }\n  })\n  if (!init) return <Placeholder color=\"text.secondary\" />\n  if (init instanceof Error) {\n    return <StyledError>Configuration error</StyledError>\n  }\n  return (\n    <ErrorBoundary key={key}>\n      <App {...{ key, init }} />\n    </ErrorBoundary>\n  )\n}\n\nfunction usePostInit(init) {\n  const dispatch = redux.useDispatch()\n  const messageParent = ipc.useMessageParent()\n  const [state, setState] = React.useState(null)\n\n  React.useEffect(() => {\n    const result = defer()\n    dispatch(Auth.actions.signIn(init.credentials, result.resolver))\n    result.promise\n      .then(() => {\n        setState(true)\n        messageParent({ type: 'init', init })\n      })\n      .catch((e) => {\n        // eslint-disable-next-line no-console\n        console.warn('Authentication failure:')\n        // eslint-disable-next-line no-console\n        console.error(e)\n        setState(new ErrorDisplay('Authentication Failure'))\n        messageParent({\n          type: 'error',\n          message: `Authentication failure: ${e.message}`,\n          credentials: init.credentials,\n        })\n      })\n  }, [init, dispatch, messageParent])\n\n  return state\n}\n\nfunction PostInit({ init, children }) {\n  const state = usePostInit(init)\n  if (!state) return <Placeholder color=\"text.secondary\" />\n  if (state instanceof Error) throw state\n  return children\n}\n\nfunction WithCustomTheme({ theme, children }) {\n  const customTheme = useMemoEq(theme, style.createCustomAppTheme)\n  return (\n    <M.MuiThemeProvider theme={customTheme}>\n      <WithGlobalStyles>{children}</WithGlobalStyles>\n    </M.MuiThemeProvider>\n  )\n}\n\nfunction CustomThemeProvider({ theme, children }) {\n  if (!theme || R.isEmpty(theme)) return children\n  return <WithCustomTheme theme={theme}>{children}</WithCustomTheme>\n}\n\nconst appendLink = (el) => {\n  const x = window.document.getElementsByTagName('link')[0]\n  x.parentNode.insertBefore(el, x)\n}\n\nconst removeLink = (el) => {\n  el.parentNode.removeChild(el)\n}\n\nfunction useCssFiles(files = []) {\n  React.useEffect(() => {\n    const els = files.map((href) => {\n      const el = window.document.createElement('link')\n      el.rel = 'stylesheet'\n      el.href = href\n      appendLink(el)\n      return el\n    })\n\n    return () => {\n      els.forEach(removeLink)\n    }\n  }, [files])\n}\n\nfunction useSyncHistory(history) {\n  const messageParent = ipc.useMessageParent()\n\n  ipc.useMessageHandler(\n    React.useCallback(\n      ({ type, ...data }) => {\n        if (type !== 'navigate') return\n        try {\n          if (!data.route) throw new Error('missing .route')\n          if (typeof data.route !== 'string') throw new Error('.route must be a string')\n          history.push(data.route)\n        } catch (e) {\n          const message = `Navigate: error: ${e.message}`\n          // eslint-disable-next-line no-console\n          console.error(message)\n          // eslint-disable-next-line no-console\n          console.log('params:', data)\n          messageParent({ type: 'error', message, data })\n        }\n      },\n      [history, messageParent],\n    ),\n  )\n\n  React.useEffect(\n    () =>\n      history.listen((l, action) => {\n        messageParent({\n          type: 'navigate',\n          route: `${l.pathname}${l.search}${l.hash}`,\n          action,\n        })\n      }),\n    [history, messageParent],\n  )\n}\n\nfunction App({ init }) {\n  const { urls } = NamedRoutes.use()\n  const history = useConstant(() =>\n    createHistory({\n      initialEntries: [init.route || urls.bucketDir(init.bucket, init.path)],\n    }),\n  )\n\n  useSyncHistory(history)\n\n  const storage = useConstant(() => ({\n    load: () => ({}),\n    set: () => {},\n    remove: () => {},\n  }))\n\n  useCssFiles(init.css)\n\n  return RT.nest(\n    [Overrides.Provider, { value: init.overrides }],\n    [EmbedConfig.Provider, { config: init }],\n    [CustomThemeProvider, { theme: init.theme }],\n    [Store.Provider, { history }],\n    [RouterProvider, { history }],\n    Cache.Provider,\n    [React.Suspense, { fallback: <Placeholder color=\"text.secondary\" /> }],\n    GraphQLProvider,\n    Notifications.Provider,\n    [APIConnector.Provider, { fetch, middleware: [Auth.apiMiddleware] }],\n    [Auth.Provider, { storage }],\n    AWS.Credentials.Provider,\n    AWS.Config.Provider,\n    AWS.S3.Provider,\n    Notifications.WithNotifications,\n    BucketCache.Provider,\n    [PostInit, { init }],\n    Root,\n  )\n}\n\nexport default function Embed() {\n  return RT.nest(\n    FinalBoundary,\n    [M.MuiThemeProvider, { theme: style.appTheme }],\n    WithGlobalStyles,\n    Layout.Root,\n    ErrorBoundary,\n    [NamedRoutes.Provider, { routes }],\n    [Init],\n  )\n}\n","/* embed/index.js - embedded browser entry point */\nimport * as React from 'react'\nimport ReactDOM from 'react-dom'\n\nimport Embed from './Embed'\n\nReactDOM.render(<Embed />, document.getElementById('app'))\n"],"names":["Context","displayName","Provider","merge","l","r","useOverrides","defaults","overrides","compile","assertIsObject","scope","obj","Error","compileTemplate","str","e","message","validateEmit","v","s3ObjectLink","href","emit","validate","input","getParamOr","param","fallback","Array","isArray","search","window","location","NONCE","nonce","Math","random","PARENT_ORIGIN","origin","useMessageParent","data","parent","postMessage","source","useMessageHandler","fn","handleMessage","type","addEventListener","removeEventListener","Ctx","EmbedConfigProvider","config","children","value","useEmbedConfig","bucketRoot","path","url","bucket","bucketFile","version","bucketDir","prefix","undefined","bucketSearch","q","p","retry","useSearchBoxStyles","t","root","background","palette","common","white","borderRadius","shape","color","overflow","position","right","transition","width","spacing","focused","paddingLeft","paddingTop","paddingBottom","textOverflow","adornment","cursor","justifyContent","pointerEvents","SearchBox","history","NamedRoutes","paths","urls","query","makeUrl","change","setFocused","handleChange","evt","target","handleKeyDown","key","push","blur","handleFocus","handleBlur","classes","startAdornment","className","placeholder","onChange","onFocus","onBlur","onKeyDown","useStyles","appBar","zIndex","btn","backgroundColor","cfg","EmbedConfig","trigger","isSearch","rootUrl","showRootLink","hideRootLink","appear","direction","in","disableGutters","maxWidth","style","display","to","component","Link","variant","fontSize","marginLeft","basename","alignItems","flexGrow","ml","Sentry","SuspensePlaceholder","Placeholder","Dir","File","Search","FinalBoundary","error","height","maxHeight","fontFamily","margin","headline","StyledError","textAlign","CatchNotFound","Root","id","pathname","hash","Bucket","BucketLayout","exact","strict","BucketCache","case","Ok","Err","_","Init","setKey","init","messageParent","ipc","state","setState","route","s3paths","Overrides","console","log","useInit","usePrevious","prev","k","App","PostInit","dispatch","result","defer","Auth","credentials","resolver","promise","then","catch","warn","usePostInit","WithCustomTheme","theme","customTheme","useMemoEq","CustomThemeProvider","removeLink","el","parentNode","removeChild","useCssFiles","files","els","map","document","createElement","rel","x","getElementsByTagName","insertBefore","appendLink","forEach","useConstant","initialEntries","listen","action","useSyncHistory","storage","load","set","remove","css","Store","GraphQL","Notifications","APIConnector","fetch","middleware","AWS","S3","Layout","routes","getElementById"],"sourceRoot":""}